{% extends 'base.html' %}
{% block content %}
<div class="grid grid-cols-1 lg:grid-cols-4 gap-4">
  <aside class="lg:col-span-1 border border-app rounded-lg p-3 bg-surface-40">
    <form action="/chat/new" method="post" class="mb-3 space-y-2">
      <div class="flex gap-2">
  <input class="w-full bg-surface border border-app rounded px-2 py-1" type="text" name="title" placeholder="New Chat Title" />
  <button class="px-3 py-1.5 btn-primary rounded text-white">New</button>
      </div>
      <div class="flex gap-2">
  <select name="provider" class="bg-surface border border-app rounded px-2 py-1 w-1/2">
          <option value="openai">OpenAI</option>
          <option value="anthropic">Anthropic</option>
          <option value="gemini">Gemini</option>
        </select>
  <input class="w-1/2 bg-surface border border-app rounded px-2 py-1" type="text" name="model" placeholder="model id (e.g., gpt-4o-mini)" />
      </div>
    </form>
    <div class="space-y-1 max-h-[70vh] overflow-auto pr-1">
      {% for s in sessions %}
  <a href="/chat/{{ s.id }}" class="block px-2 py-2 rounded {{ 'bg-surface' if session and session.id == s.id else 'hover:bg-surface-strong' }}">
        <div class="text-sm text-slate-400">{{ s.provider }} â€¢ {{ s.model }}</div>
        <div class="font-medium">{{ s.title }}</div>
      </a>
      {% else %}
      <div class="text-slate-400 text-sm">No chats yet</div>
      {% endfor %}
    </div>
  </aside>

  <section class="lg:col-span-3 border border-app rounded-lg bg-surface-40 overflow-hidden">
    {% if session %}
  <div class="border-b border-app p-3 flex items-center gap-2">
      <form action="/chat/{{ session.id }}/meta" method="post" class="flex flex-wrap items-center gap-2 w-full">
  <input class="bg-surface border border-app rounded px-2 py-1" name="title" value="{{ session.title }}" />
  <select name="provider" class="bg-surface border border-app rounded px-2 py-1">
          <option value="openai" {{ 'selected' if session.provider=='openai' else '' }}>OpenAI</option>
          <option value="anthropic" {{ 'selected' if session.provider=='anthropic' else '' }}>Anthropic</option>
          <option value="gemini" {{ 'selected' if session.provider=='gemini' else '' }}>Gemini</option>
        </select>
  <input class="bg-surface border border-app rounded px-2 py-1 flex-1 min-w-[200px]" name="model" value="{{ session.model }}" />
  <button class="px-3 py-1.5 bg-surface border border-app rounded hover:bg-surface-strong" type="submit">Save</button>
        <form action="/chat/{{ session.id }}/delete" method="post" class="ml-auto">
          <button class="px-3 py-1.5 bg-red-600 hover:bg-red-500 rounded text-white" formaction="/chat/{{ session.id }}/delete">Delete</button>
        </form>
      </form>
    </div>
  <div class="p-4 space-y-4 max-h-[65vh] overflow-auto" id="messages">
      {% for m in messages %}
      <div class="flex {{ 'justify-start' if m.role!='user' else 'justify-end' }}">
  <div class="max-w-3xl px-4 py-2 rounded-lg border text-app {{ 'bg-surface border-app' if m.role=='user' else 'bg-surface-40 border-app' }}">
          <div class="text-xs uppercase tracking-wide text-slate-400 mb-1">{{ m.role }}</div>
          <div class="whitespace-pre-wrap">{{ m.content }}</div>
        </div>
      </div>
      {% else %}
      <div class="text-slate-400 text-sm">No messages yet. Say hello!</div>
      {% endfor %}
    </div>
  <div class="border-t border-app p-3">
      <form action="/chat/{{ session.id }}/message" method="post" class="flex gap-2">
    <textarea name="content" rows="2" class="flex-1 bg-surface border border-app rounded px-3 py-2" placeholder="Type your message..."></textarea>
    <button class="px-4 py-2 btn-primary rounded text-white">Send</button>
      </form>
    </div>
    {% else %}
    <div class="p-8 text-center text-slate-400">Create a new chat from the left panel.</div>
    {% endif %}
  </section>
</div>
{% endblock %}
